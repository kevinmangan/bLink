{% extends "base.html" %}

	{% block content %}

<div class="main-content">
					<div class="breadcrumbs" id="breadcrumbs">
						<script type="text/javascript">
							try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
						</script>

						<ul class="breadcrumb">
							<li>
								<i class="icon-home home-icon"></i>
								<a href="#">Home</a>
							</li>

							<li>
								<a href="#">More Pages</a>
							</li>
							<li class="active">Inbox</li>
						</ul><!-- .breadcrumb -->

						<div class="nav-search" id="nav-search">
							<form class="form-search">
								<span class="input-icon">
									<input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
									<i class="icon-search nav-search-icon"></i>
								</span>
							</form>
						</div><!-- #nav-search -->
					</div>

					<div class="page-content">
						<div class="page-header">
							<h1>
								Inbox
							</h1>
						</div><!-- /.page-header -->

						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->

								<div class="row">
									<div class="col-xs-12">
										<div class="tabbable">
											<ul id="inbox-tabs" class="inbox-tabs nav nav-tabs padding-16 tab-size-bigger tab-space-1">

												<li class="active">
													<a data-toggle="tab" href="#inbox" data-target="inbox">
														<i class="blue icon-inbox bigger-130"></i>
														<span class="bigger-110">Inbox</span>
													</a>
												</li>

												<li>
													<a data-toggle="tab" href="#sent" data-target="sent">
														<i class="orange icon-location-arrow bigger-130 "></i>
														<span class="bigger-110">Sent</span>
													</a>
												</li>

											</ul>

											<div class="tab-content no-border no-padding">
												<div class="tab-pane in active">
													<div class="message-container">
														<div id="id-message-list-navbar" class="message-navbar align-center clearfix">
															<div class="message-bar">
																<div class="message-infobar" id="id-message-infobar">
																	<span class="blue bigger-150">Inbox</span>
																	<span class="grey bigger-110"> ({{g.user.unread_messages()}} unread messages)</span>
																</div>

																<div class="message-toolbar hide">

																	<a href="#" class="btn btn-xs btn-message">
																		<i class="icon-trash bigger-125"></i>
																		<span class="bigger-110">Delete</span>
																	</a>
																</div>
															</div>

															<div>
																<div class="messagebar-item-left">
																	<label class="inline middle">
																		<input type="checkbox" id="id-toggle-all" class="ace" />
																		<span class="lbl"></span>
																	</label>

																	&nbsp;
																	<div class="inline position-relative">
																		<a href="#" data-toggle="dropdown" class="dropdown-toggle">
																			<i class="icon-caret-down bigger-125 middle"></i>
																		</a>

																		<ul class="dropdown-menu dropdown-lighter dropdown-100">
																			<li>
																				<a id="id-select-message-all" href="#">All</a>
																			</li>

																			<li>
																				<a id="id-select-message-none" href="#">None</a>
																			</li>

																			<li class="divider"></li>

																			<li>
																				<a id="id-select-message-unread" href="#">Unread</a>
																			</li>

																			<li>
																				<a id="id-select-message-read" href="#">Read</a>
																			</li>
																		</ul>
																	</div>
																</div>

																<div class="messagebar-item-right">
																	<div class="inline position-relative">
																		<a href="#" data-toggle="dropdown" class="dropdown-toggle">
																			Sort &nbsp;
																			<i class="icon-caret-down bigger-125"></i>
																		</a>

																		<ul class="dropdown-menu dropdown-lighter pull-right dropdown-100">
																			<li>
																				<a href="#">
																					<i class="icon-ok green"></i>
																					Date
																				</a>
																			</li>

																			<li>
																				<a href="#">
																					<i class="icon-ok invisible"></i>
																					From
																				</a>
																			</li>

																			<li>
																				<a href="#">
																					<i class="icon-ok invisible"></i>
																					Subject
																				</a>
																			</li>
																		</ul>
																	</div>
																</div>

																<div class="nav-search minimized">
																	<form class="form-search">
																		<span class="input-icon">
																			<input type="text" autocomplete="off" class="input-small nav-search-input" placeholder="Search inbox ..." />
																			<i class="icon-search nav-search-icon"></i>
																		</span>
																	</form>
																</div>
															</div>
														</div>

														<div id="id-message-item-navbar" class="hide message-navbar align-center clearfix">
															<div class="message-bar">
																<div class="message-toolbar">
																	<a href="#" class="btn btn-xs btn-message">
																		<i class="icon-reply bigger-125"></i>
																		<span class="bigger-110">Reply</span>
																	</a>

																	<a href="#" class="btn btn-xs btn-message">
																		<i class="icon-trash bigger-125"></i>
																		<span class="bigger-110">Delete</span>
																	</a>
																</div>
															</div>

															<div>
																<div class="messagebar-item-left">
																	<a href="#" class="btn-back-message-list">
																		<i class="icon-arrow-left blue bigger-110 middle"></i>
																		<b class="bigger-110 middle">Back</b>
																	</a>
																</div>

																<div class="messagebar-item-right">
																	<i class="icon-time bigger-110 orange middle"></i>
																	<span class="time grey">Today, 7:15 pm</span>
																</div>
															</div>
														</div>

														<div id="id-message-new-navbar" class="hide message-navbar align-center clearfix">
															<div class="message-bar">
																<div class="message-toolbar">
																	<a href="#" class="btn btn-xs btn-message">
																		<i class="icon-remove bigger-125"></i>
																		<span class="bigger-110">Discard</span>
																	</a>
																</div>
															</div>

															<div class="message-item-bar">
																<div class="messagebar-item-left">
																	<a href="#" class="btn-back-message-list no-hover-underline">
																		<i class="icon-arrow-left blue bigger-110 middle"></i>
																		<b class="middle bigger-110">Back</b>
																	</a>
																</div>

															</div>
														</div>

														<div class="message-list-container">
															<div class="message-list" id="message-list">
																
															{% for conversation in g.user.conversations.all() %}
																	{% set message = conversation.mostRecentMessage(g.user) %}
																	{% if message %}
																		{% if message.isNew %}
																	
																	
																	<div class="message-item message-unread">
																		<label class="inline">
																			<input type="checkbox" class="ace" />
																			<span class="lbl"></span>
																		</label>

																		<!-- <i class="message-star icon-star orange2"></i> -->
																		<i class="message-star icon-star-empty light-grey"></i>
																		<span class="sender" title="{{message.sentFrom[0].firstName}}">{{message.sentFrom[0].firstName}} {{message.sentFrom[0].lastName}} </span>
																		<span class="time">{{message.getTime()}}</span>

																		<span class="summary">
																			<span class="text" id="{{conversation.id}}">
																				{{conversation.subject}}

																			</span>
																		</span>
																	</div>
																	{% else %}
																	<div class="message-item">
																		<label class="inline">
																			<input type="checkbox" class="ace" />
																			<span class="lbl"></span>
																		</label>

																		<i class="message-star icon-star orange2"></i>
																		<span class="sender" title="{{message.sentFrom[0].firstName}}">{{message.sentFrom[0].firstName}} {{message.sentFrom[0].lastName}} </span>
																		<span class="time">{{message.getTime()}}</span>

																		<span class="summary">
																			<span class="text" id="{{conversation.id}}">
																				{{conversation.subject}}
																			</span>
																		</span>
																	</div>
																		{% endif %}
																	{% endif %}
																	
																	<div class="hide message-content {{conversation.id}}" id="id-message-content{{conversation.id}}">
																	{% for message in conversation.messages %}
																		<div class="message-header clearfix">
																			<div class="pull-left">
																				<div class="space-4"></div>

																				<i class="icon-star orange2 mark-star"></i>

																				&nbsp;
																				<img class="middle" alt="John's Avatar" src="../static/avatars/avatar.png" width="32" />
																				&nbsp;
																				<a href="#" class="sender">{{message.sentFrom[0].firstName}} {{message.sentFrom[0].lastName}}</a>

																				&nbsp;
																				<i class="icon-time bigger-110 orange middle"></i>
																				<span class="time">{{message.getTime()}}</span>
																			</div>

																			<div class="action-buttons pull-right">
																				<a href="#">
																					<i class="icon-reply green icon-only bigger-130"></i>
																				</a>

																				<a href="#">
																					<i class="icon-mail-forward blue icon-only bigger-130"></i>
																				</a>

																				<a href="#">
																					<i class="icon-trash red icon-only bigger-130"></i>
																				</a>
																			</div>
																		</div>

																		<hr>

																		
																			
																				{{message.body}}
																		<br>
																		<div class="hr hr-double"></div>
																		{% endfor %}
																	</div><!-- /.message-content -->
																

																<form id="form{{conversation.id}}" class="hide form-horizontal message-form col-xs-12" method="post">
																{% set sentTo = [] %} <!-- Template scope doesn't let you change value inside loops -->
																{% for user in conversation.users %}
																	{% if user != g.user %}
																		{% if sentTo.append(user) %} {% endif %}
																	{% endif %}
																{% endfor %}
																<input type="hidden" name="sentTo" value="{{sentTo[0].id}}"></input>
																<input type="hidden" name="conversation" value="{{conversation.id}}"></input>
																	
																		<div class="form-group">
																			<div class="col-sm-9">
																				<div class="wysiwyg-editor" name="body"></div>
																			</div>
																		</div>

																		<div class="hr hr-18 dotted"></div>
																		<div class="space"></div>
																	
																	<span class="inline btn-send-message">
																		<button type="submit" class="btn btn-sm btn-primary no-border submit">
																			<span class="bigger-110">Send</span>

																			<i class="icon-arrow-right icon-on-right"></i>
																		</button>
																	</span>
																</form>
															{% endfor %}

															</div>
														</div><!-- /.message-list-container -->

														<div class="message-footer clearfix">
															{% if g.user.receivedMessages %}
																<div class="pull-left"> {{ g.user.receivedMessages.all()|count }} messages total </div>
															{% else %}
																<div class="pull-left"> You have 0 messages </div>
															{% endif %}
															<div class="pull-right">
																<div class="inline middle"> page 1 of 16 </div>

																&nbsp; &nbsp;
																<ul class="pagination middle">
																	<li class="disabled">
																		<span>
																			<i class="icon-step-backward middle"></i>
																		</span>
																	</li>

																	<li class="disabled">
																		<span>
																			<i class="icon-caret-left bigger-140 middle"></i>
																		</span>
																	</li>

																	<li>
																		<span>
																			<input value="1" maxlength="3" type="text" />
																		</span>
																	</li>

																	<li>
																		<a href="#">
																			<i class="icon-caret-right bigger-140 middle"></i>
																		</a>
																	</li>

																	<li>
																		<a href="#">
																			<i class="icon-step-forward middle"></i>
																		</a>
																	</li>
																</ul>
															</div>
														</div>

														<div class="hide message-footer message-footer-style2 clearfix">
														
														</div>

													</div><!-- /.message-container -->
												</div><!-- /.tab-pane -->
											</div><!-- /.tab-content -->
										</div><!-- /.tabbable -->
									</div><!-- /.col -->
								</div><!-- /.row -->

								



								<!-- PAGE CONTENT ENDS -->
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content -->
				</div><!-- /.main-content -->


	{% endblock %}

	{% block inboxScripts %}
		{{ super() }}
	{%	endblock %}